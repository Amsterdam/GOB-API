version: "3.4"

services:

  migrate:
    build:
      context: ../../../../GOB-Upload/src
      target: development
    environment:
      DATABASE_HOST_OVERRIDE: test_db
      DATABASE_PORT_OVERRIDE: 5432
      DATABASE_NAME: gobtest
      DATABASE_USER: gobtest
      DATABASE_PASSWORD: insecure

      # Temporary branch for brk2.
      REPO_BASE: "https://raw.githubusercontent.com/Amsterdam/amsterdam-schema/brk2_active_dataset"
    depends_on:
      - test_db
    command: bash -c "alembic upgrade head && python -m gobupload migrate"
    volumes:
      - ${GOB_CORE_DIR-../../../../GOB-Core}:/app/GOB-Core

  test:
    command: >
      echo "Service is disabled for migration"
